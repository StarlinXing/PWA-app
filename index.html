<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ç¬¬ä¸€å€‹ PWA</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding-top: 50px;
            background-color: #f0f0f0;
            color: #333;
        }
        h1 {
            color: #4CAF50;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            display: inline-block;
            background-color: white;
        }
    </style>
</head>
<body>

    <h1>ğŸš€ æ­¡è¿ä¾†åˆ°æˆ‘çš„ PWA æ¸¬è©¦æ‡‰ç”¨</h1>
    <p>é€™æ˜¯ä¸€å€‹ç¬¦åˆåŸºæœ¬ PWA è¦ç¯„çš„ H5 é é¢ã€‚</p>
    
    <div class="status">
        <p>Service Worker ç‹€æ…‹: <span id="sw-status">è¼‰å…¥ä¸­...</span></p>
        <p>ç¶²è·¯ç‹€æ…‹: <span id="online-status">æª¢æŸ¥ä¸­...</span></p>
    </div>

    <button id="installButton" style="display:none; padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
    ä¸€éµæ·»åŠ åˆ°æ¡Œé¢ï¼
</button>

<script>
    let deferredPrompt; // ç”¨ä¾†å„²å­˜ç€è¦½å™¨äº‹ä»¶çš„è®Šæ•¸
    const installButton = document.getElementById('installButton');

    // 1. æ•æ‰ç€è¦½å™¨çš„å®‰è£æç¤ºäº‹ä»¶
    window.addEventListener('beforeinstallprompt', (e) => {
        // é˜»æ­¢ç€è¦½å™¨é¡¯ç¤ºå…¶é è¨­çš„è‡ªå‹•æç¤º
        e.preventDefault(); 
        
        // å„²å­˜é€™å€‹äº‹ä»¶ï¼Œä»¥ä¾¿ä¹‹å¾Œå¯ä»¥æ‰‹å‹•è§¸ç™¼
        deferredPrompt = e; 
        
        // é¡¯ç¤ºæ‚¨çš„è‡ªå®šç¾©æŒ‰éˆ•
        installButton.style.display = 'block'; 
        
        console.log('beforeinstallprompt äº‹ä»¶å·²æ•æ‰ï¼ŒæŒ‰éˆ•é¡¯ç¤º');
    });

    // 2. ç›£è½è‡ªå®šç¾©æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶
    installButton.addEventListener('click', (e) => {
        if (deferredPrompt) {
            // éš±è—è‡ªå®šç¾©æŒ‰éˆ•
            installButton.style.display = 'none';
            
            // è§¸ç™¼ç€è¦½å™¨å„²å­˜çš„åŸç”Ÿå®‰è£æç¤º
            deferredPrompt.prompt(); 
            
            // ç›£è½ç”¨æˆ¶çš„é¸æ“‡
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('ç”¨æˆ¶æ¥å—å®‰è£ PWA');
                } else {
                    console.log('ç”¨æˆ¶æ‹’çµ•å®‰è£ PWA');
                }
                deferredPrompt = null;
            });
        }
    });

    // ... [æ‚¨åŸæœ‰çš„ Service Worker è¨»å†Šä»£ç¢¼] ...
</script>

    <script>
        // === PWA Service Worker è¨»å†Š ===
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker è¨»å†ŠæˆåŠŸ:', registration);
                        document.getElementById('sw-status').textContent = 'å·²è¨»å†Š âœ…';
                    })
                    .catch(error => {
                        console.error('Service Worker è¨»å†Šå¤±æ•—:', error);
                        document.getElementById('sw-status').textContent = 'è¨»å†Šå¤±æ•— âŒ';
                    });
            });
        } else {
            document.getElementById('sw-status').textContent = 'ç€è¦½å™¨ä¸æ”¯æŒ Service Worker âŒ';
        }
        
        // ç°¡å–®çš„ç¶²è·¯ç‹€æ…‹æª¢æŸ¥
        window.addEventListener('online', () => document.getElementById('online-status').textContent = 'é€£ç·šä¸­ ğŸŸ¢');
        window.addEventListener('offline', () => document.getElementById('online-status').textContent = 'é›¢ç·š ğŸ”´');
        document.getElementById('online-status').textContent = navigator.onLine ? 'é€£ç·šä¸­ ğŸŸ¢' : 'é›¢ç·š ğŸ”´';
        
    </script>
</body>
</html>
